# Backend environment (.env)
# - Copy to `backend/.env` for local development.
# - Only a small subset of settings MUST be set; most have safe defaults in `backend/app/core/config.py`.

# ------------------------------------------------------------------------------
# Required: Database
# ------------------------------------------------------------------------------
# Note: backend converts `postgresql://` -> `postgresql+asyncpg://` automatically (see `backend/app/db/session.py`).
DATABASE_URL=postgresql://user:password@host:5432/dbname

# ------------------------------------------------------------------------------
# Required: Supabase (Storage)
# ------------------------------------------------------------------------------
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
SUPABASE_SERVICE_KEY=your-service-role-key
SUPABASE_BUCKET=knowledge

# ------------------------------------------------------------------------------
# Required: Security/JWT
# ------------------------------------------------------------------------------
JWT_SECRET=your-secret-key
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ------------------------------------------------------------------------------
# Required: OpenAI
# ------------------------------------------------------------------------------
OPENAI_API_KEY=sk-...

# ------------------------------------------------------------------------------
# Common overrides: app runtime
# ------------------------------------------------------------------------------
ENVIRONMENT=development
ALLOWED_ORIGINS=*
API_V1_STR=/api/v1

# ------------------------------------------------------------------------------
# Common overrides: models
# ------------------------------------------------------------------------------
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_TIMEOUT_SECONDS=12
OPENAI_MAX_RETRIES=1
NLU_MODEL=gpt-4o-mini
RAG_ANSWER_MODEL=gpt-4o-mini
RAG_DECOMPOSE_MODEL=gpt-4o-mini
EMBEDDING_MODEL=text-embedding-3-small
PRODUCT_EMBEDDING_MODEL=text-embedding-3-small
CHAT_FAIL_FAST_ON_EMBEDDING_ERROR=true

# ------------------------------------------------------------------------------
# RAG tuning
# ------------------------------------------------------------------------------
RAG_RETRIEVE_TOPK_KNOWLEDGE=30
RAG_MAX_CHUNK_CHARS_FOR_CONTEXT=1200
KNOWLEDGE_DISTANCE_THRESHOLD=0.40
PRODUCT_DISTANCE_THRESHOLD=0.35

# ------------------------------------------------------------------------------
# Product import embedding tuning (affects CSV imports/backfills)
# ------------------------------------------------------------------------------
PRODUCT_EMBEDDING_PAGE_SIZE=1000
PRODUCT_EMBEDDING_BATCH_SIZE=128
PRODUCT_EMBEDDING_MAX_CONCURRENCY=4
PRODUCT_EMBEDDING_MAX_RETRIES=4
PRODUCT_EMBEDDING_RETRY_BASE_MS=500
PRODUCT_EMBEDDING_PROGRESS_INTERVAL_SECONDS=5

# ------------------------------------------------------------------------------
# Agentic function calling (read-only tools; optional)
# ------------------------------------------------------------------------------
AGENTIC_FUNCTION_CALLING_ENABLED=false
AGENTIC_ALLOWED_CHANNELS=widget,qa_console
AGENTIC_MODEL=
AGENTIC_MAX_TOOL_ROUNDS=4
AGENTIC_MAX_TOOL_CALLS=6
AGENTIC_TOOL_TIMEOUT_MS=3500
AGENTIC_MAX_TOOL_RESULT_ITEMS=10
AGENTIC_ENABLE_FALLBACK=true

# ------------------------------------------------------------------------------
# Localization (optional)
# ------------------------------------------------------------------------------
UI_LOCALIZATION_ENABLED=true
DEFAULT_LOCALE=en-US
CHAT_LANGUAGE_MODE=auto
FIXED_REPLY_LANGUAGE=en-US

# ------------------------------------------------------------------------------
# Currencies (optional)
# ------------------------------------------------------------------------------
BASE_CURRENCY=USD
PRICE_DISPLAY_CURRENCY=USD
# JSON object where rates mean: `1 USD = X units` (example shown).
CURRENCY_RATES_JSON={"THB":35.0}

# ------------------------------------------------------------------------------
# Semantic cache (optional)
# ------------------------------------------------------------------------------
SEMANTIC_CACHE_ENABLED=true
SEMANTIC_CACHE_THRESHOLD=0.96
SEMANTIC_CACHE_TTL_DAYS=7
CHAT_FIELD_AWARE_DETAIL_ENABLED=true
CHAT_DETAIL_MAX_MATCHES=3
CHAT_DETAIL_MIN_CONFIDENCE=0.55
CHAT_DETAIL_ENABLE_SEMANTIC_CACHE=false
CHAT_HOT_CACHE_ENABLED=true
CHAT_HOT_CACHE_MAX_ITEMS=3000
CHAT_HOT_CACHE_TTL_SECONDS=300
CHAT_HOT_CACHE_VERSION=v1
CHAT_SQL_FIRST_ENABLED=true
CHAT_PROJECTION_READ_ENABLED=false
CHAT_PROJECTION_DUAL_WRITE_ENABLED=true
CHAT_STRUCTURED_CANDIDATE_CAP=300
CHAT_STRUCTURED_QUERY_CACHE_ENABLED=true
CHAT_STRUCTURED_QUERY_CACHE_MAX_ITEMS=2000
CHAT_STRUCTURED_QUERY_CACHE_TTL_SECONDS=600
CHAT_NLU_HEURISTIC_THRESHOLD=0.85
CHAT_EXTERNAL_CALL_BUDGET=3
CHAT_EXTERNAL_CALL_FAIL_FAST_SECONDS=3.5
CHAT_EXTERNAL_CALL_RETRY_MAX=1
CHAT_VECTOR_TOP_K=12
CHAT_CROSS_SELL_MODE=off
CHAT_MAX_HISTORY_TOKENS=1200
CHAT_LLM_RENDER_ONLY_GUARD=true
CHAT_HARD_MAX_LLM_CALLS_PER_REQUEST=0
CHAT_HARD_MAX_EMBEDDINGS_PER_REQUEST=1
CHAT_STRICT_RETRIEVAL_SEPARATION_ENABLED=false
CHAT_CATALOG_VERSION=v1
CHAT_PROMPT_VERSION=v1
CHAT_CACHE_LOG_INTERVAL_SECONDS=60
CHAT_COMPONENT_BUCKETS_ENABLED=false
CHAT_COMPONENT_BUCKETS_SHADOW_MODE=false
CHAT_COMPONENT_BUCKETS_REQUIRE_COMPONENTS=false
CHAT_REDIS_CACHE_ENABLED=false
CHAT_REDIS_URL=
CHAT_REDIS_KEY_PREFIX=chat:components

# ------------------------------------------------------------------------------
# Uploads/storage (optional)
# ------------------------------------------------------------------------------
UPLOAD_DIR=uploads
MAX_UPLOAD_SIZE=52428800
